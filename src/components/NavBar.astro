---
import CustomButton from '../components/CustomButton.astro';

let isMenuOpen = false; // Estado que controla la visibilidad del menú
---

<nav role="navigation" class="bg-bars relative shadow-md">
	<div class="flex items-center justify-between p-[0.5rem]">
		{/* Logo Mobil */}
		<a href="/" aria-label="Ir a la página de inicio">
			<img
				src="/icons/logoMobil.svg"
				width={32}
				height={40}
				alt="Logo de la empresa"
				class="rounded"
			/>
		</a>

		{/* Botón de menú hamburguesa */}
		<button
			id="toggleMenuBtn"
			class="ml-auto flex h-[32px] w-[32px] cursor-pointer items-center justify-center rounded bg-[#b2c8e0] text-white xl:hidden"
			aria-label="Abrir menú de navegación"
			aria-controls="menu-hamburguer"
			onclick={() => {
				isMenuOpen = !isMenuOpen;
			}}
			{/* Toggle menú */}
		>
			☰
		</button>
	</div>

	{/* Menú flotante de navegación */}
	<ul
		id="menu-hamburguer"
		class={`absolute right-0 z-10 mt-[1rem] flex flex-col gap-[1rem] rounded bg-neutral-200 p-[1rem] text-end shadow-lg transition-all duration-300 ${isMenuOpen ? 'opacity-100' : 'pointer-events-none opacity-0'}`}
	>
		<li>
			<a
				href="/sobre-mi"
				class="rounded-lg p-[0.5rem] transition hover:bg-neutral-600 hover:text-white"
				onClick={() => (isMenuOpen = false)}
				{/* Cerrar menú al hacer clic */}
			>
				Sobre Mí
			</a>
		</li>
		<li>
			<a
				href="/servicios"
				class="rounded-lg p-[0.5rem] transition hover:bg-neutral-600 hover:text-white"
				onClick={() => (isMenuOpen = false)}
			>
				Servicios
			</a>
		</li>
		<li>
			<a
				href="/testimonios"
				class="rounded-lg p-[0.5rem] transition hover:bg-neutral-600 hover:text-white"
				onClick={() => (isMenuOpen = false)}
			>
				Testimonios
			</a>
		</li>
		<li>
			<a
				href="/blog"
				class="rounded-lg p-[0.5rem] transition hover:bg-neutral-600 hover:text-white"
				onClick={() => (isMenuOpen = false)}
			>
				Blog
			</a>
		</li>
		<li>
			<a
				href="/contacto"
				class="rounded-lg p-[0.5rem] transition hover:bg-neutral-600 hover:text-white"
				onClick={() => (isMenuOpen = false)}
			>
				Contacto
			</a>
		</li>
		{/* Botón de llamada a la acción */}
		<li>
			<CustomButton btnText="Agenda tu cita" btnLink="/contacto" />
		</li>
	</ul>
</nav>

<script>
	// Este script maneja el estado del menú en el lado del cliente
	let isMenuOpen = false;

	// Seleccionamos el botón y el menú
	const toggleMenuBtn = document.getElementById('toggleMenuBtn');
	const menu = document.getElementById('menu-hamburguer');

	// Función para abrir/cerrar el menú
	toggleMenuBtn.addEventListener('click', (event) => {
		// Prevenimos el cierre inmediato al hacer clic en el botón de menú
		event.stopPropagation();
		isMenuOpen = !isMenuOpen;
		menu.style.opacity = isMenuOpen ? '1' : '0';
		menu.style.pointerEvents = isMenuOpen ? 'auto' : 'none';
	});

	// Cerrar el menú cuando se haga clic en cualquier enlace
	const links = document.querySelectorAll('#menu-hamburguer a');
	links.forEach((link) => {
		link.addEventListener('click', () => {
			isMenuOpen = false;
			menu.style.opacity = '0';
			menu.style.pointerEvents = 'none';
		});
	});

	// Cerrar el menú cuando se haga clic fuera de la barra de navegación
	document.addEventListener('click', (event) => {
		// Verifica si el clic fue fuera del menú y el botón de hamburguesa
		if (!toggleMenuBtn.contains(event.target) && !menu.contains(event.target)) {
			isMenuOpen = false;
			menu.style.opacity = '0';
			menu.style.pointerEvents = 'none';
		}
	});
</script>
